<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Usuários</title>
<style>
body{margin:0;font-family:'Inter',sans-serif;background:#f5f5f5;color:#2c3e50;}
header{background:#2c3e50;color:white;text-align:center;padding:20px;font-size:1.5rem;font-weight:600;box-shadow:0 2px 6px rgba(0,0,0,.2);}
main{max-width:1000px;margin:30px auto;padding:0 15px;}
table{width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.08);}
thead{background:#2c3e50;color:white;}
thead th{padding:12px;text-align:left;font-weight:500;}
tbody td{padding:10px;border-bottom:1px solid #e0e0e0;vertical-align:middle;}
tbody tr:hover{background:#f0f0f0;cursor:pointer;}
img.user-img{width:50px;height:50px;border-radius:50%;object-fit:cover;cursor:pointer;transition:transform .3s;}
img.user-img:hover{transform:scale(1.2);}
.status{padding:3px 8px;border-radius:12px;font-size:0.8rem;font-weight:600;text-transform:uppercase;color:white;}
.status.pendente{background:#f39c12;}
.status.aprovado{background:#27ae60;}
.status.reprovado{background:#c0392b;}
button{padding:5px 12px;border:none;border-radius:6px;cursor:pointer;font-size:0.8rem;font-weight:600;color:white;transition:.2s;}
button.aprovar{background:#27ae60;} button.aprovar:hover{background:#1f7a42;}
button.reprovar{background:#c0392b;} button.reprovar:hover{background:#8e2920;}

/* Modal */
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;visibility:hidden;opacity:0;transition:.3s;z-index:999;}
.modal.active{visibility:visible;opacity:1;}
.modal-content{background:white;border-radius:12px;padding:25px;max-width:450px;width:90%;text-align:center;position:relative;overflow-y:auto;max-height:90vh;box-shadow:0 4px 20px rgba(0,0,0,.25);}
.modal-content img{width:140px;height:140px;border-radius:50%;object-fit:cover;margin-bottom:10px;cursor:zoom-in;transition:transform .3s;}
.modal-content img:hover{transform:scale(1.05);}
.modal-close{position:absolute;top:10px;right:15px;font-size:1.5rem;cursor:pointer;}
.modal-content p{margin:6px 0;font-size:0.95rem;}
.modal-content p b{color:#2c3e50;}
.modal-buttons{display:flex;justify-content:center;gap:10px;margin-top:10px;flex-wrap:wrap;}

/* Fullscreen */
#fullscreen{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);display:flex;align-items:center;justify-content:center;visibility:hidden;opacity:0;transition:.3s;z-index:9999;}
#fullscreen.active{visibility:visible;opacity:1;}
#fullscreen img{max-width:95%;max-height:95%;border-radius:8px;object-fit:contain;cursor:zoom-out;}

/* Mobile cards */
.mobile-card{display:none;background:white;border-radius:10px;padding:15px;margin-bottom:15px;box-shadow:0 2px 8px rgba(0,0,0,.1);cursor:pointer;flex-direction:column;align-items:center;transition:.3s;}
.mobile-card:hover{transform:translateY(-3px);box-shadow:0 4px 12px rgba(0,0,0,.15);}
.mobile-card img{width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:8px;}
.mobile-card .info{text-align:center;margin-bottom:8px;}
.mobile-card .info p{margin:2px 0;font-weight:600;}
.mobile-card .actions{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;}
@media(max-width:900px){table{display:none;}.mobile-card{display:flex;}}
</style>
</head>
<body>

<header>Painel Usuários</header>
<main>
  <table id="usuariosTable">
    <thead>
      <tr>
        <th>Foto</th>
        <th>Nome</th>
        <th>OMIX</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="mobileContainer"></div>
</main>

<!-- Modal -->
<div class="modal" id="modalDetalhes">
  <div class="modal-content">
    <span class="modal-close" id="fecharModal">&times;</span>
    <img id="modalImg" src="" alt="Usuário">
    <p><b>Nome:</b> <span id="modalNome"></span></p>
    <p><b>OMIX:</b> <span id="modalOmix"></span></p>
    <p><b>Data Nascimento:</b> <span id="modalData"></span></p>
    <p><b>Gênero:</b> <span id="modalGenero"></span></p>
    <p><b>Telefone:</b> <span id="modalTelefone"></span></p>
    <p><b>Sala:</b> <span id="modalSala"></span></p>
    <p><b>Período:</b> <span id="modalPeriodo"></span></p>
    <p><b>Observações:</b> <span id="modalText"></span></p>
    <p><b>Status:</b> <span id="modalStatus" class="status"></span></p>
    <div class="modal-buttons">
      <button class="aprovar" id="btnAprovar">Aprovar</button>
      <button class="reprovar" id="btnReprovar">Reprovar</button>
    </div>
  </div>
</div>

<!-- Fullscreen -->
<div id="fullscreen"><img id="fsImg" src="" alt="Usuário"></div>

<script>
const tbody=document.querySelector("#usuariosTable tbody");
const mobileContainer=document.getElementById("mobileContainer");
const modal=document.getElementById('modalDetalhes');
const fecharModal=document.getElementById('fecharModal');
const modalImg=document.getElementById('modalImg');
const modalNome=document.getElementById('modalNome');
const modalOmix=document.getElementById('modalOmix');
const modalData=document.getElementById('modalData');
const modalGenero=document.getElementById('modalGenero');
const modalTelefone=document.getElementById('modalTelefone');
const modalSala=document.getElementById('modalSala');
const modalPeriodo=document.getElementById('modalPeriodo');
const modalText=document.getElementById('modalText');
const modalStatus=document.getElementById('modalStatus');
const btnAprovar=document.getElementById('btnAprovar');
const btnReprovar=document.getElementById('btnReprovar');
const fullscreen=document.getElementById('fullscreen');
const fsImg=document.getElementById('fsImg');

let usuarios=[],usuarioAtual=null;

async function carregarUsuarios(){
  try{
    const res=await fetch("https://omix-front.onrender.com/users");
    usuarios=await res.json();
    tbody.innerHTML="";
    mobileContainer.innerHTML="";
    usuarios.forEach(u=>{
      const imgSrc=u.imagem?`${u.imagem}`:'./uploads/default.png';
      
      // Desktop
      const tr=document.createElement('tr');
      tr.innerHTML=`<td><img class="user-img" src="${imgSrc}"></td><td>${u.nome}</td><td>${u.omix}</td><td><span class="status ${u.status}">${u.status}</span></td><td><button class="aprovar">Aprovar</button><button class="reprovar">Reprovar</button></td>`;
      tbody.appendChild(tr);
      tr.querySelector('.user-img').onclick=e=>{e.stopPropagation();abrirFullscreen(imgSrc);}
      tr.querySelector('.aprovar').onclick=e=>{e.stopPropagation();atualizarStatus(u,'aprovar');}
      tr.querySelector('.reprovar').onclick=e=>{e.stopPropagation();atualizarStatus(u,'reprovar');}
      tr.onclick=()=>abrirModal(u,imgSrc);

      // Mobile
      const card=document.createElement('div'); card.className='mobile-card';
      card.innerHTML=`<img src="${imgSrc}"><div class="info"><p>${u.nome}</p><span class="status ${u.status}">${u.status}</span></div><div class="actions"><button class="aprovar">Aprovar</button><button class="reprovar">Reprovar</button></div>`;
      mobileContainer.appendChild(card);
      card.querySelector('img').onclick=e=>{e.stopPropagation();abrirFullscreen(imgSrc);}
      card.querySelector('.aprovar').onclick=e=>{e.stopPropagation();atualizarStatus(u,'aprovar');}
      card.querySelector('.reprovar').onclick=e=>{e.stopPropagation();atualizarStatus(u,'reprovar');}
      card.onclick=()=>abrirModal(u,imgSrc);
    });
  }catch(e){console.error(e);tbody.innerHTML="<tr><td colspan='5'>Erro ao carregar usuários.</td></tr>";}
}

function abrirModal(u,imgSrc){
  usuarioAtual=u;
  modalImg.src=imgSrc;
  modalNome.textContent=u.nome;
  modalOmix.textContent=u.omix;
  modalData.textContent=u.data||'N/A';
  modalGenero.textContent=u.genero||'N/A';
  modalTelefone.textContent=u.telefone||'N/A';
  modalSala.textContent=u.sala||'N/A';
  modalPeriodo.textContent=u.periodo||'N/A';
  modalText.textContent=u.text||'Nenhuma';
  modalStatus.textContent=u.status;
  modalStatus.className=`status ${u.status}`;
  modal.classList.add('active');
}
function fecharModalFunc(){modal.classList.remove('active');}
fecharModal.onclick=fecharModalFunc;
modal.onclick=e=>{if(e.target===modal)fecharModalFunc();}

btnAprovar.onclick=()=>{if(usuarioAtual) atualizarStatus(usuarioAtual,'aprovar');}
btnReprovar.onclick=()=>{if(usuarioAtual) atualizarStatus(usuarioAtual,'reprovar');}

function abrirFullscreen(src){fsImg.src=src;fullscreen.classList.add('active');}
fullscreen.onclick=()=>fullscreen.classList.remove('active');

async function atualizarStatus(u,acao){
  try{
    const res=await fetch(`https://omix-front.onrender.com/user/${acao}/${u.omix}`,{method:'PUT'});
    const data=await res.json();
    if(data.usuario){u.status=data.usuario.status;carregarUsuarios();if(usuarioAtual&&usuarioAtual.omix===u.omix){modalStatus.textContent=u.status;modalStatus.className=`status ${u.status}`;}}
  }catch(e){alert('Erro ao atualizar status.');console.error(e);}
}

carregarUsuarios();
</script>
</body>
</html>
